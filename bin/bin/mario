#!/bin/sh
# ┏┏┓┳━┓┳━┓o┏━┓
# ┃┃┃┃━┫┃┳┛┃┃ ┃
# ┛ ┇┛ ┇┇┗┛┇┛━┛
# p l u m b e r

url="$1"
filetype=$(curl -Ls "${url}" | file - | awk '{print $2}')

iso_type() {
	_iso=$(curl -Ls "${url}" | file - | awk '{print $4}')
	case ${_iso} in
		MP4) /usr/bin/mpv "${url}" ;;
		*) /usr/bin/notify-send -u 'normal' "mario: unknown iso type ${_iso}" ;;
	esac
}

vimify() {
	timestamp=$(date +%s)
	curl -L -o /tmp/mario-${timestamp} "${1}"
	LANG=en_US.UTF-8 urxvt -cd /home/pyratebeard -hold -e vim /tmp/mario-${timestamp}
	rm -f /tmp/mario-${timestamp}
}

plumbit() {
	case ${filetype} in
		JPEG|PNG|GIF) /home/pyratebeard/bin/webimg "${url}" ;;
		Audio|WebM) /usr/bin/mpv "${url}" ;;
		POSIX) LANG=en_US.UTF-8 urxvt -hold -e curl -s ${url} ;;
		ISO) iso_type ;;
		HTML|XML) qutebrowser "${url}" ;;
		Unicode|Bourne-Again|ASCII|C|Python) vimify "${url}" ;;
		PDF) curl -L -o /tmp/mario.pdf "${url}" ; zathura /tmp/mario.pdf ; rm -f /tmp/mario.pdf ;;
		*) /usr/bin/notify-send -u 'normal' "mario: unknown filetype ${filetype}" ;;
	esac
}

vidreg="(youtu|watch?v=)"
(([[ "${url}" =~ $vidreg ]] && mpv "${url}") || ([[ "${url}" == *"gallery"* ]] && qutebrowser "${url}")) || plumbit
