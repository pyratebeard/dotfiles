#!/bin/sh

usage() {
	echo "usage: $(basename $0) [-c charset] file" >&2
}

while getopts 'c:h' OPT; do
	case $OPT in
		c) charset=$OPTARG ;;
		h) usage; exit 0 ;;
		*) usage; exit 1 ;;
	esac
done

shift $((OPTIND -1))

[ -z "$charset" ] && charset="$(file -i $1 | sed 's/.* charset=//')"
iconv -f $charset -t utf-8 $1 \
	| webdump -al \
	| sed 'y/ / /;s/^\s*$//' \
	| cat -s
